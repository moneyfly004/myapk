# NekoBox è®¤è¯ç³»ç»Ÿ - UI æ¼”ç¤ºå’ŒåŠŸèƒ½è¯´æ˜

## ğŸ¨ é¡µé¢æ•ˆæœè¯¦è§£

### 1ï¸âƒ£ ç™»å½•é¡µé¢ (LoginActivity)

#### è§†è§‰æ•ˆæœ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                 â”‚
â”‚         [NekoBox Logo]          â”‚  â† 80x80 åº”ç”¨å›¾æ ‡ï¼Œå±…ä¸­æ˜¾ç¤º
â”‚                                 â”‚
â”‚            ç™»å½•                 â”‚  â† å¤§æ ‡é¢˜ (HeadlineMedium)
â”‚      è¯·è¾“å…¥æ‚¨çš„é‚®ç®±å’Œå¯†ç         â”‚  â† å‰¯æ ‡é¢˜ (BodyMedium)
â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ“§ é‚®ç®±                  â”‚   â”‚  â† é‚®ç®±è¾“å…¥æ¡†ï¼Œå¸¦å›¾æ ‡
â”‚  â”‚ user@example.com        â”‚   â”‚  â† è¾“å…¥æç¤º
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ”’ å¯†ç               ğŸ‘  â”‚   â”‚  â† å¯†ç æ¡†ï¼Œå¸¦æ˜¾ç¤º/éšè—æŒ‰é’®
â”‚  â”‚ â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                 â”‚
â”‚         â­• Loading...           â”‚  â† åŠ è½½æŒ‡ç¤ºå™¨ï¼ˆç™»å½•æ—¶æ˜¾ç¤ºï¼‰
â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚        ç™»å½•              â”‚   â”‚  â† å¤§æŒ‰é’®ï¼Œ56dp é«˜åº¦
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                 â”‚
â”‚   è¿˜æ²¡æœ‰è´¦å·ï¼Ÿ [ç«‹å³æ³¨å†Œ]       â”‚  â† æ–‡æœ¬ + é“¾æ¥æŒ‰é’®
â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### äº¤äº’ç»†èŠ‚
1. **å®æ—¶éªŒè¯**ï¼š
   - è¾“å…¥é‚®ç®±åè‡ªåŠ¨æ£€æŸ¥æ ¼å¼
   - é‚®ç®±æ ¼å¼é”™è¯¯æ—¶æ˜¾ç¤ºçº¢è‰²é”™è¯¯æç¤º
   - å¯†ç å°‘äº8ä½æ—¶æç¤º"å¯†ç è‡³å°‘8ä½"

2. **Loading çŠ¶æ€**ï¼š
   - ç‚¹å‡»"ç™»å½•"åæŒ‰é’®å˜ç°è‰²ç¦ç”¨
   - æ˜¾ç¤ºåœ†å½¢åŠ è½½åŠ¨ç”»
   - è¾“å…¥æ¡†å…¨éƒ¨ç¦ç”¨é˜²æ­¢é‡å¤æäº¤

3. **é”™è¯¯æç¤º**ï¼š
   - ç©ºé‚®ç®±ï¼š`emailLayout.error = "è¯·è¾“å…¥é‚®ç®±"`
   - æ ¼å¼é”™è¯¯ï¼š`emailLayout.error = "é‚®ç®±æ ¼å¼ä¸æ­£ç¡®"`
   - ç™»å½•å¤±è´¥ï¼šToast æç¤º "ç™»å½•å¤±è´¥: [é”™è¯¯ä¿¡æ¯]"

4. **æˆåŠŸæç¤º**ï¼š
   - Toast: "ç™»å½•æˆåŠŸï¼"
   - Toast: "è®¢é˜…å·²è·å–ï¼åˆ°æœŸ: 2026-12-24"
   - è‡ªåŠ¨è·³è½¬åˆ°ä¸»é¡µ

---

### 2ï¸âƒ£ æ³¨å†Œé¡µé¢ (RegisterActivity)

#### è§†è§‰æ•ˆæœ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                 â”‚
â”‚            æ³¨å†Œ                 â”‚  â† æ ‡é¢˜
â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ‘¤ ç”¨æˆ·å                â”‚   â”‚
â”‚  â”‚ nickname                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ“§ é‚®ç®±                  â”‚   â”‚
â”‚  â”‚ user@example.com        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ”’ å¯†ç ï¼ˆè‡³å°‘8ä½ï¼‰    ğŸ‘  â”‚   â”‚
â”‚  â”‚ â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ éªŒè¯ç (å¯é€‰) â”‚ â”‚å‘é€éªŒè¯ç â”‚  â”‚  â† éªŒè¯ç è¾“å…¥ + å‘é€æŒ‰é’®
â”‚  â”‚ 123456       â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                 â”‚
â”‚         â­• Loading...           â”‚  â† åŠ è½½æŒ‡ç¤ºå™¨
â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚        æ³¨å†Œ              â”‚   â”‚  â† æ³¨å†ŒæŒ‰é’®
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### äº¤äº’ç»†èŠ‚
1. **éªŒè¯ç åŠŸèƒ½**ï¼š
   - ç‚¹å‡»"å‘é€éªŒè¯ç "
   - æŒ‰é’®å˜ä¸º "60ç§’åé‡è¯•"ï¼ˆå€’è®¡æ—¶ï¼‰
   - 60ç§’åæ¢å¤ä¸º"å‘é€éªŒè¯ç "
   - éªŒè¯ç æ˜¯å¯é€‰çš„ï¼ˆåç«¯é…ç½®å†³å®šï¼‰

2. **è¡¨å•éªŒè¯**ï¼š
   ```kotlin
   - ç”¨æˆ·åä¸èƒ½ä¸ºç©º
   - é‚®ç®±æ ¼å¼å¿…é¡»æ­£ç¡® (Patterns.EMAIL_ADDRESS)
   - å¯†ç è‡³å°‘8ä½
   - æ‰€æœ‰éªŒè¯å®æ—¶è¿›è¡Œï¼Œé”™è¯¯ç«‹å³æ˜¾ç¤º
   ```

3. **æ³¨å†Œæµç¨‹**ï¼š
   ```
   è¾“å…¥ä¿¡æ¯ â†’ å‘é€éªŒè¯ç (å¯é€‰) â†’ ç‚¹å‡»æ³¨å†Œ â†’ æ˜¾ç¤ºLoading
   â†“
   æˆåŠŸï¼šToastæç¤º "æ³¨å†ŒæˆåŠŸ" â†’ è¿”å›ç™»å½•é¡µ
   â†“
   å¤±è´¥ï¼šToastæç¤ºé”™è¯¯ä¿¡æ¯ï¼Œåœç•™åœ¨æ³¨å†Œé¡µ
   ```

---

### 3ï¸âƒ£ å¿˜è®°å¯†ç é¡µé¢ (ç›®å‰æœªå®ç°)

è™½ç„¶æˆ‘åˆ›å»ºäº†æ•°æ®æ¨¡å‹ï¼Œä½†å®é™…çš„ Activity è¿˜æ²¡æœ‰å®ç°ã€‚å¦‚æœéœ€è¦ï¼Œå¯ä»¥å¿«é€Ÿæ·»åŠ ï¼š

```kotlin
// é¢„ç•™çš„æ•°æ®æ¨¡å‹
data class ForgotPasswordRequest(
    val email: String,
    val verificationCode: String,
    val newPassword: String
)
```

---

### 4ï¸âƒ£ ä¸»é¡µ - é€€å‡ºç™»å½•æŒ‰é’®

#### ä¾§è¾¹èœå•æ•ˆæœ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  NekoBox            â”‚  â† åº”ç”¨æ ‡é¢˜
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âš™ï¸  é…ç½®             â”‚
â”‚ ğŸ“‹ è®¢é˜…ç»„            â”‚
â”‚ ğŸ”€ è·¯ç”±              â”‚
â”‚ ğŸ› ï¸  è®¾ç½®             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ› æ—¥å¿—              â”‚
â”‚ ğŸ“Š ä»ªè¡¨æ¿            â”‚
â”‚ ğŸ”§ å·¥å…·              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ”— æ¨å¹¿              â”‚
â”‚ ğŸ“š æ–‡æ¡£              â”‚
â”‚ â„¹ï¸  å…³äº             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸšª é€€å‡ºç™»å½•          â”‚  â† æ–°å¢çš„é€€å‡ºæŒ‰é’®
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### é€€å‡ºç™»å½•äº¤äº’
```kotlin
ç‚¹å‡»"é€€å‡ºç™»å½•" 
    â†“
å¼¹å‡ºç¡®è®¤å¯¹è¯æ¡†:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      é€€å‡ºç™»å½•            â”‚
â”‚                         â”‚
â”‚  ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ      â”‚
â”‚                         â”‚
â”‚  [å–æ¶ˆ]      [ç¡®å®š]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
ç‚¹å‡»"ç¡®å®š":
  - æ¸…é™¤ Token (authRepository.logout())
  - æ¸…é™¤è®¢é˜…ä¿¡æ¯ (subscription_prefs)
  - è·³è½¬åˆ°ç™»å½•é¡µ
  - æ¸…é™¤è¿”å›æ ˆ (FLAG_ACTIVITY_CLEAR_TASK)
```

---

## ğŸ”— åå°å¯¹æ¥è¯¦è§£

### API åŸºç¡€é…ç½®

```kotlin
// AuthRepository.kt
private val BASE_URL = "https://dy.moneyfly.top"
private val client = OkHttpClient.Builder()
    .connectTimeout(30, TimeUnit.SECONDS)
    .readTimeout(30, TimeUnit.SECONDS)
    .writeTimeout(30, TimeUnit.SECONDS)
    .build()
```

### 1. ç™»å½•æ¥å£

**API ç«¯ç‚¹**: `POST /api/auth/login`

**è¯·æ±‚ç¤ºä¾‹**:
```json
{
    "email": "user@example.com",
    "password": "mypassword123"
}
```

**å“åº”ç¤ºä¾‹**:
```json
{
    "success": true,
    "message": "ç™»å½•æˆåŠŸ",
    "data": {
        "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
        "email": "user@example.com",
        "username": "nickname"
    }
}
```

**Kotlin å®ç°**:
```kotlin
suspend fun login(email: String, password: String): Result<LoginResponse> {
    val json = JsonObject().apply {
        addProperty("email", email)
        addProperty("password", password)
    }
    
    val request = Request.Builder()
        .url("$BASE_URL/api/auth/login")
        .post(json.toString().toRequestBody("application/json".toMediaType()))
        .build()
    
    val response = client.newCall(request).execute()
    // è§£æå“åº”å¹¶ä¿å­˜ Token
}
```

---

### 2. æ³¨å†Œæ¥å£

**API ç«¯ç‚¹**: `POST /api/auth/register`

**è¯·æ±‚ç¤ºä¾‹**:
```json
{
    "username": "nickname",
    "email": "user@example.com",
    "password": "mypassword123",
    "verification_code": "123456",  // å¯é€‰
    "invite_code": "INVITE2024"     // å¯é€‰
}
```

**å“åº”ç¤ºä¾‹**:
```json
{
    "success": true,
    "message": "æ³¨å†ŒæˆåŠŸ"
}
```

---

### 3. å‘é€éªŒè¯ç æ¥å£

**API ç«¯ç‚¹**: `POST /api/auth/send-verification-code`

**è¯·æ±‚ç¤ºä¾‹**:
```json
{
    "email": "user@example.com",
    "type": "register"  // æˆ– "reset_password"
}
```

**å“åº”ç¤ºä¾‹**:
```json
{
    "success": true,
    "message": "éªŒè¯ç å·²å‘é€åˆ°æ‚¨çš„é‚®ç®±"
}
```

---

### 4. è·å–è®¢é˜…æ¥å£ ğŸ”‘

**API ç«¯ç‚¹**: `GET /api/subscription/user`

**è¯·æ±‚å¤´**:
```
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

**å“åº”ç¤ºä¾‹**:
```json
{
    "success": true,
    "data": {
        "universal_url": "vmess://eyJhZGQiOiI...",
        "subscription_url": "https://...",
        "expire_time": "2026-12-24",
        "upload_traffic": 1024000,
        "download_traffic": 5120000,
        "total_traffic": 107374182400
    }
}
```

**Kotlin å®ç°**:
```kotlin
suspend fun getUserSubscription(): Result<UserSubscription> {
    val token = getToken() ?: return Result.failure(Exception("æœªç™»å½•"))
    
    val request = Request.Builder()
        .url("$BASE_URL/api/subscription/user")
        .header("Authorization", "Bearer $token")  // â† JWT è®¤è¯
        .get()
        .build()
    
    val response = client.newCall(request).execute()
    // è§£æè®¢é˜…ä¿¡æ¯
}
```

---

## ğŸ”„ è‡ªåŠ¨å¯¼å…¥è®¢é˜…æµç¨‹è¯¦è§£

### å®Œæ•´æµç¨‹å›¾

```
åº”ç”¨å¯åŠ¨ (MainActivity.onCreate)
    â†“
æ£€æŸ¥è®¤è¯çŠ¶æ€ (authRepository.isAuthenticated())
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æœªç™»å½•ï¼Ÿ                             â”‚
â”‚   YES â†’ è·³è½¬ç™»å½•é¡µ                   â”‚
â”‚   NO  â†’ ç»§ç»­                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
ç”¨æˆ·ç™»å½•æˆåŠŸ (LoginActivity)
    â†“
è°ƒç”¨ fetchSubscription()
    â†“
GET /api/subscription/user (å¸¦ Token)
    â†“
è·å– universal_url å’Œ expire_time
    â†“
ä¿å­˜åˆ° SharedPreferences:
  - subscription_url: "vmess://..."
  - expire_time: "2026-12-24"
  - has_subscription: true
    â†“
è·³è½¬åˆ°ä¸»é¡µ MainActivity
    â†“
MainActivity.checkAndAddSubscription()
    â†“
è¯»å– SharedPreferences
    â†“
æ£€æŸ¥æ˜¯å¦æœ‰è®¢é˜…ä¿¡æ¯ï¼Ÿ
    â†“
YES â†’ åˆ›å»º SubscriptionBean
    â†“
è®¾ç½®è®¢é˜…åç§° = "åˆ°æœŸ: 2026-12-24"
    â†“
GroupManager.createGroup(subscription)
    â†“
GroupUpdater.startUpdate(subscription, true)
    â†“
æ˜¾ç¤º Snackbar: "è®¢é˜…å·²è‡ªåŠ¨æ·»åŠ : åˆ°æœŸ: 2026-12-24"
    â†“
å®Œæˆï¼ç”¨æˆ·å¯ä»¥ç›´æ¥ä½¿ç”¨
```

### å…³é”®ä»£ç å®ç°

#### 1. ç™»å½•æˆåŠŸåè·å–è®¢é˜…

```kotlin
// LoginActivity.kt - Line 120
private suspend fun fetchSubscription() {
    val result = authRepository.getUserSubscription()
    
    result.onSuccess { subscription ->
        if (subscription.universalUrl.isNotEmpty()) {
            // ä¿å­˜è®¢é˜…ä¿¡æ¯åˆ° SharedPreferences
            val prefs = getSharedPreferences("subscription_prefs", MODE_PRIVATE)
            prefs.edit().apply {
                putString("subscription_url", subscription.universalUrl)
                putString("expire_time", subscription.expireTime)
                putBoolean("has_subscription", true)
                apply()
            }
            
            Toast.makeText(
                this@LoginActivity,
                "è®¢é˜…å·²è·å–ï¼åˆ°æœŸ: ${subscription.expireTime}",
                Toast.LENGTH_LONG
            ).show()
        }
        
        navigateToMain()  // è·³è½¬åˆ°ä¸»é¡µ
    }
}
```

#### 2. ä¸»é¡µå¯åŠ¨æ—¶è‡ªåŠ¨æ·»åŠ è®¢é˜…

```kotlin
// MainActivity.kt - Line 88
override fun onCreate(savedInstanceState: Bundle?) {
    super.onCreate(savedInstanceState)
    
    // åˆå§‹åŒ–è®¤è¯ä»“åº“
    authRepository = AuthRepository(this)
    
    // æ£€æŸ¥è®¤è¯çŠ¶æ€
    if (!authRepository.isAuthenticated()) {
        // æœªç™»å½•ï¼Œè·³è½¬åˆ°ç™»å½•é¡µ
        startActivity(Intent(this, LoginActivity::class.java))
        finish()
        return
    }
    
    // å·²ç™»å½•ï¼Œæ£€æŸ¥å¹¶è‡ªåŠ¨æ·»åŠ è®¢é˜…
    checkAndAddSubscription()
    
    // ... å…¶ä»–åˆå§‹åŒ–ä»£ç 
}

// MainActivity.kt - Line 495
private fun checkAndAddSubscription() {
    val prefs = getSharedPreferences("subscription_prefs", MODE_PRIVATE)
    val hasSubscription = prefs.getBoolean("has_subscription", false)
    val subscriptionUrl = prefs.getString("subscription_url", null)
    
    if (hasSubscription && !subscriptionUrl.isNullOrEmpty()) {
        lifecycleScope.launch {
            try {
                runOnDefaultDispatcher {
                    // è‡ªåŠ¨æ·»åŠ è®¢é˜…
                    val expireTime = prefs.getString("expire_time", "æœªè®¾ç½®")
                    val groupName = if (expireTime != "æœªè®¾ç½®") {
                        "åˆ°æœŸ: $expireTime"  // â† æ™ºèƒ½å‘½å
                    } else {
                        "æˆ‘çš„è®¢é˜…"
                    }
                    
                    val subscription = SubscriptionBean().apply {
                        name = groupName
                        type = GroupType.SUBSCRIPTION
                        link = subscriptionUrl
                    }
                    
                    val groupId = GroupManager.createGroup(subscription)
                    
                    // æ›´æ–°è®¢é˜…ï¼ˆä¸‹è½½èŠ‚ç‚¹ä¿¡æ¯ï¼‰
                    GroupUpdater.startUpdate(subscription, true)
                    
                    onMainDispatcher {
                        Snackbar.make(
                            binding.root,
                            "è®¢é˜…å·²è‡ªåŠ¨æ·»åŠ : $groupName",
                            Snackbar.LENGTH_LONG
                        ).show()
                    }
                }
            } catch (e: Exception) {
                e.printStackTrace()
            }
        }
    }
}
```

### æ•°æ®æŒä¹…åŒ–

#### SharedPreferences å­˜å‚¨ç»“æ„

```kotlin
// è®¤è¯ä¿¡æ¯ (auth_prefs)
{
    "auth_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user_email": "user@example.com",
    "user_username": "nickname"
}

// è®¢é˜…ä¿¡æ¯ (subscription_prefs)
{
    "has_subscription": true,
    "subscription_url": "vmess://eyJhZGQiOiI...",
    "expire_time": "2026-12-24"
}
```

---

## ğŸ¯ å®é™…ä½¿ç”¨æµç¨‹æ¼”ç¤º

### åœºæ™¯1ï¼šé¦–æ¬¡ä½¿ç”¨

```
1. æ‰“å¼€åº”ç”¨
   â†“
2. æ˜¾ç¤ºç™»å½•é¡µï¼ˆæ£€æµ‹åˆ°æœªç™»å½•ï¼‰
   â†“
3. ç‚¹å‡»"ç«‹å³æ³¨å†Œ"
   â†“
4. å¡«å†™: ç”¨æˆ·åã€é‚®ç®±ã€å¯†ç 
   â†“
5. ç‚¹å‡»"å‘é€éªŒè¯ç "
   â†“
6. è¾“å…¥éªŒè¯ç ï¼ˆæˆ–è·³è¿‡ï¼‰
   â†“
7. ç‚¹å‡»"æ³¨å†Œ"
   â†“
8. Toastæç¤ºï¼š"æ³¨å†ŒæˆåŠŸ"
   â†“
9. è¿”å›ç™»å½•é¡µ
   â†“
10. è¾“å…¥é‚®ç®±ã€å¯†ç 
   â†“
11. ç‚¹å‡»"ç™»å½•"
   â†“
12. Toastæç¤ºï¼š"ç™»å½•æˆåŠŸï¼"
   â†“
13. Toastæç¤ºï¼š"è®¢é˜…å·²è·å–ï¼åˆ°æœŸ: 2026-12-24"
   â†“
14. è¿›å…¥ä¸»é¡µ
   â†“
15. Snackbaræç¤ºï¼š"è®¢é˜…å·²è‡ªåŠ¨æ·»åŠ : åˆ°æœŸ: 2026-12-24"
   â†“
16. è®¢é˜…ç»„åˆ—è¡¨ä¸­å‡ºç°æ–°è®¢é˜…
   â†“
17. ç‚¹å‡»ä¸»é¡µçš„è¿æ¥æŒ‰é’®
   â†“
18. å¼€å§‹ä½¿ç”¨ï¼
```

### åœºæ™¯2ï¼šå·²ç™»å½•ç”¨æˆ·

```
1. æ‰“å¼€åº”ç”¨
   â†“
2. æ£€æµ‹åˆ°å·²ç™»å½• â†’ ç›´æ¥è¿›å…¥ä¸»é¡µ
   â†“
3. è‡ªåŠ¨æ£€æŸ¥è®¢é˜…å¹¶æ·»åŠ ï¼ˆå¦‚æœè¿˜æ²¡æ·»åŠ ï¼‰
   â†“
4. æ­£å¸¸ä½¿ç”¨
```

### åœºæ™¯3ï¼šé€€å‡ºç™»å½•

```
1. ç‚¹å‡»ä¾§è¾¹èœå•
   â†“
2. æ»šåŠ¨åˆ°åº•éƒ¨
   â†“
3. ç‚¹å‡»"é€€å‡ºç™»å½•"
   â†“
4. å¼¹å‡ºå¯¹è¯æ¡†ï¼š"ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ"
   â†“
5. ç‚¹å‡»"ç¡®å®š"
   â†“
6. æ¸…é™¤æ‰€æœ‰è®¤è¯ä¿¡æ¯å’Œè®¢é˜…ä¿¡æ¯
   â†“
7. è¿”å›ç™»å½•é¡µ
```

---

## ğŸ” å®‰å…¨ç‰¹æ€§

1. **Token ç®¡ç†**ï¼š
   - JWT Token å­˜å‚¨åœ¨ SharedPreferences
   - æ‰€æœ‰è®¢é˜… API è¯·æ±‚éƒ½å¸¦ Authorization header
   - é€€å‡ºç™»å½•æ—¶æ¸…é™¤æ‰€æœ‰ Token

2. **å¯†ç å®‰å…¨**ï¼š
   - å¯†ç è¾“å…¥æ¡†å¸¦æ˜¾ç¤º/éšè—æŒ‰é’®
   - å¯†ç è‡³å°‘8ä½å¼ºåˆ¶éªŒè¯
   - å¯†ç é€šè¿‡ HTTPS ä¼ è¾“ï¼ˆä¸åœ¨å®¢æˆ·ç«¯åŠ å¯†ï¼‰

3. **é”™è¯¯å¤„ç†**ï¼š
   - æ‰€æœ‰ API è°ƒç”¨éƒ½æœ‰ try-catch
   - ç½‘ç»œè¶…æ—¶è®¾ç½® 30 ç§’
   - å‹å¥½çš„é”™è¯¯æç¤º

---

## ğŸ“± UI é£æ ¼

- **è®¾è®¡è¯­è¨€**: Material Design 3
- **é¢œè‰²æ–¹æ¡ˆ**: è·Ÿéšç³»ç»Ÿä¸»é¢˜ï¼ˆæ”¯æŒæ·±è‰²æ¨¡å¼ï¼‰
- **å­—ä½“**: 
  - æ ‡é¢˜: `TextAppearance.Material3.HeadlineMedium`
  - æ­£æ–‡: `TextAppearance.Material3.BodyMedium`
- **åŠ¨ç”»**: 
  - Loading ä½¿ç”¨åœ†å½¢è¿›åº¦æŒ‡ç¤ºå™¨
  - Toast å’Œ Snackbar æç¤º
- **å¸ƒå±€**: ConstraintLayout + ScrollViewï¼ˆæ”¯æŒå°å±å¹•æ»šåŠ¨ï¼‰

---

## ğŸ“ æ€»ç»“

### âœ… å·²å®ç°
1. âœ… ç™»å½•é¡µé¢ - å®Œæ•´çš„ UI å’Œåå°å¯¹æ¥
2. âœ… æ³¨å†Œé¡µé¢ - åŒ…å«éªŒè¯ç åŠŸèƒ½
3. âœ… é€€å‡ºç™»å½• - ä¾§è¾¹èœå•æŒ‰é’® + ç¡®è®¤å¯¹è¯æ¡†
4. âœ… è‡ªåŠ¨è®¢é˜… - ç™»å½•åè‡ªåŠ¨è·å–å¹¶æ·»åŠ 
5. âœ… Token ç®¡ç† - å®Œæ•´çš„è®¤è¯çŠ¶æ€ç®¡ç†
6. âœ… æ™ºèƒ½å‘½å - è®¢é˜…åç§°æ˜¾ç¤ºåˆ°æœŸæ—¶é—´

### â³ æœªå®ç°
1. âŒ å¿˜è®°å¯†ç é¡µé¢ï¼ˆæ•°æ®æ¨¡å‹å·²å‡†å¤‡ï¼ŒActivity æœªå®ç°ï¼‰
2. âŒ Token è‡ªåŠ¨åˆ·æ–°ï¼ˆéœ€è¦åç«¯æ”¯æŒï¼‰
3. âŒ å¤šè´¦å·åˆ‡æ¢

### ğŸ¨ UI è´¨é‡
- Material Design 3 æ ‡å‡†
- å“åº”å¼å¸ƒå±€
- å®Œæ•´çš„ Loading çŠ¶æ€
- å‹å¥½çš„é”™è¯¯æç¤º
- æ”¯æŒæ·±è‰²æ¨¡å¼

---

**å¦‚æœæƒ³çœ‹å®é™…æ•ˆæœï¼Œéœ€è¦ç­‰ libcore ç¼–è¯‘å®Œæˆåå®‰è£… APK åˆ°æ‰‹æœºä¸Šæµ‹è¯•ï¼** ğŸ“±

